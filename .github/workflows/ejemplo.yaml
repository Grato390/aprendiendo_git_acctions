name: Procesar datos de la tienda

on: 
  push:
    branches: main3  # ğŸ”¥ Se ejecuta cuando hay cambios en la rama main
  workflow_dispatch:  # ğŸ”„ Permite ejecutarlo manualmente desde GitHub

jobs:
  procesar_datos:
    runs-on: ubuntu-latest  # ğŸŒ Se ejecutarÃ¡ en una mÃ¡quina con Ubuntu

    steps:
    - name: ğŸ“¥ Descargar cÃ³digo del repositorio
      uses: actions/checkout@v4  # ğŸ”¹ Necesario para acceder a los archivos del repo

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"  # ğŸ”¹ Configura la versiÃ³n de Python

    - name: ğŸ” Mostrar archivos disponibles
      run: ls -R  # ğŸ“‚ Lista la estructura del repo

    - name: ğŸ“„ Leer contenido de datos.json
      run: cat datos.json  # ğŸ”¹ Muestra el contenido del JSON en la terminal

    - name: ğŸš€ Ejecutar script.py
      run: python script.py  # ğŸ”¹ Ejecuta el script y procesa los datos

    - name: ğŸ“ Extraer datos clave desde JSON
      run: |
        STOCK_BAJO=$(jq '[.productos[] | select(.stock < 5)] | length' datos.json)
        echo "STOCK_BAJO=$STOCK_BAJO" >> $GITHUB_ENV  # ğŸ”¹ Guarda en variable de entorno
        echo "ğŸ” Productos con bajo stock: $STOCK_BAJO"

    - name: âš ï¸ Verificar si hay productos con bajo stock
      if: env.STOCK_BAJO > 0  # ğŸ”¥ CondiciÃ³n en GitHub Actions
      run: echo "âš ï¸ Â¡Alerta! Hay productos con bajo stock"

    - name: ğŸ“¤ Guardar el reporte de inventario
      run: |
        echo "### Reporte de Inventario ğŸš€" > reporte.md
        echo "$(date)" >> reporte.md
        echo "\nProductos con bajo stock: $STOCK_BAJO" >> reporte.md
      shell: bash

    - name: ğŸ“¦ Subir reporte como artefacto
      uses: actions/upload-artifact@v4

      with:
        name: Reporte-Inventario
        path: reporte.md  # ğŸ”¹ Permite descargarlo desde GitHub Actions

    - name: âœ… Finalizar workflow
      run: echo "ğŸ‰ Workflow completado con Ã©xito"
